\documentclass[onecolumn, draftclsnofoot,10pt, compsoc]{IEEEtran}

\usepackage{float}
\usepackage{graphicx}
\usepackage{url}
\usepackage{setspace}
\usepackage{geometry}
\usepackage{listings}
\usepackage{color}
\usepackage{etoolbox}
\usepackage{pdflscape}

\patchcmd{\thebibliography}{\section*{\refname}}{}{}{}

\geometry{textheight=9.5in, textwidth=7in}

% 1. Fill in these details
\def \CapstoneTeamName{			              			 PlanteR-GB}
\def \CapstoneTeamNumber{					           			 Group 64}
\def \GroupMemberOne{				           				Austin Hodgin}
\def \GroupMemberTwo{				           				Travis Hodgin}
\def \GroupMemberThree{			            Maximillian Schmidt}
\def\GroupMemberFour{		        	               Zach Lerew}
\def \CapstoneProjectName{	      	    Winter is Coming...}
\def \CapstoneSponsorCompany{		    Oregon State University}
\def \CapstoneSponsorPerson{		 			  				 Victor Hsu}

% 2. Uncomment the appropriate line below so that the document type works
\def \DocType{		%Problem Statement
				%Requirements Document
				%Technology Review
				Design Document
				%Progress Report
				}

\newcommand{\NameSigPair}[1]{\par
\makebox[2.75in][r]{#1} \hfil 	\makebox[3.25in]{\makebox[2.25in]{\hrulefill} \hfill		\makebox[.75in]{\hrulefill}}
\par\vspace{-12pt} \textit{\tiny\noindent
\makebox[2.75in]{} \hfil		\makebox[3.25in]{\makebox[2.25in][r]{Signature} \hfill	\makebox[.75in][r]{Date}}}}
% 3. If the document is not to be signed, uncomment the RENEWcommand below
\renewcommand{\NameSigPair}[1]{#1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\begin{titlepage}
    \pagenumbering{gobble}
    \begin{singlespace}
    	%\includegraphics[height=4cm]{coe_v_spot1}
        \hfill

        % 4. If you have a logo, use this includegraphics command to put it on the coversheet.
        \includegraphics[height=4cm]{logo.png}

        \par\vspace{.2in}
        \centering
        \scshape{
            \huge CS Capstone \DocType \par
            {\large\today}\par
            \vspace{.5in}
            \textbf{\Huge\CapstoneProjectName}\par

            %\vfill
						\vspace{1in}

            {\large Prepared for}\par
            \Huge \CapstoneSponsorCompany\par
            \vspace{5pt}
            {\Large\NameSigPair{\CapstoneSponsorPerson}\par}

						\vspace{1in}

            {\large Prepared by}\par
						{\huge \CapstoneTeamNumber}\par
            \CapstoneTeamName\par
            \vspace{5pt}

            {
							\Large
							\NameSigPair{\GroupMemberOne}\par
							\NameSigPair{\GroupMemberTwo}\par
							\NameSigPair{\GroupMemberThree}\par
							\NameSigPair{\GroupMemberFour}\par
            }

            \vspace{20pt}
        }
%\textbf{\textsuperscript{citation needed}}
				\newpage
        \begin{abstract}
				\noindent This document details the entire system design for the PlanteR-GB system
        \end{abstract}
    \end{singlespace}
\end{titlepage}

\newpage

\pagenumbering{arabic}
\tableofcontents
% 7. uncomment this (if applicable). Consider adding a page break.
\listoffigures
%\listoftables
\clearpage
\singlespace

\newpage


% Syntax highlighting
\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\lstset{
  backgroundcolor=\color{white},   % choose the background color
  basicstyle=\footnotesize,        % size of fonts used for the code
  breaklines=true,                 % automatic line breaking only at whitespace
  captionpos=b,                    % sets the caption-position to bottom
  commentstyle=\color{mygreen},    % comment style
  escapeinside={\%*}{*)},          % if you want to add LTeX within your code
  keywordstyle=\color{blue},       % keyword style
  stringstyle=\color{mymauve},     % string literal style
	frame = single,                  % code framing
}


% Document outline based on summary of IEEE 1016-2009 from http://www.zeynepaltan.info/SDD-Template.pdf

	% Introduction
	\section{Introduction}
		\subsection{Purpose}
		\subsection{Scope}
		\subsection{Overview}
		\subsection{Definitions and Acronyms}
		\textbf{UI} - User Interface
		\\\textbf{API} - Application Programming Interface
		\\\textbf{REST} - \textbf{Re}presentational \textbf{S}tate \textbf{T}ransfer.


		\subsection{Reference Material}
			\begingroup
				\renewcommand{\addcontentsline}[3]{}% Remove functionality of \addcontentsline
				\renewcommand{\section}[2]{}% Remove functionality of \section
				%\cite[Sec 3.8]{sourceName}
				\bibliography{ref}
				\bibliographystyle{IEEEtran}
			\endgroup

	\section{System Overview}
		\subsection{Assumptions}
		\subsection{General Constraints}
		\subsection{System Environment}


	\section{System Architecture}
		\subsection{System Diagram}

		\noindent \\This system is comprised of many distinct pieces. Each of them will be explored in further depth in the sections below.

		\begin{center}
			\begin{figure}[H]
				\includegraphics[width=\linewidth]{systemDiagrams/systemdiag.png}
				\caption{The PlanteR-GB system including interface and control systems}
				\label{fig:systemDiagram}
			\end{figure}
		\end{center}

		\subsection{Hardware}
			\subsubsection{Overview}
			\subsubsection{Master Controller}
			\subsubsection{Slave Controller(s)}


		\subsection{Control Service}
			\subsubsection{Overview}
			The control service is the bridge between the user interface and the LEDs.
			It has an API that serves as the entry point for all system changes, an internal state representation which is fed to the LED control system and translated to persistent storage.
			The API obfuscates the communication between the client UI and the control service by providing a set of routes through which data can be sent.
			To make a data request or modification, the client sends data to the control service using one of the REST verbs (GET, POST, PUT, DELETE, etc) in addition to its data.
			Using the REST protocol simplifies communication between client and server, but also allows new settings and parameters to quickly become accessible through the addition of new routes.

			\hfill \break
			\noindent The control service internal state is the primary representation of the settings and configuration of the system.
			This internal state is the focal point of the API, data storage, and LED control system.
			It is responsible for representing all data and committing it into persistent storage.
			When a client UI makes a change to a system parameter, the data is routed through the API and into the internal state

			\hfill \break
			\noindent The data parser is responsible for translating the objects representing the system's state into persistent storage.
			When the system starts, the data parser reads from persistent storage and builds the system's internal state.
			API requests cause the data parser to copy the current system state into persistent storage.
			Effectively, the data parser defines the contract between the system and persistent storage.

			\subsubsection{API}
			%pistache.io is a good REST library for C++
			The API will follow a REST protocol. REST is an architectural style and modern approach to web service communication. \cite{rest1}
			It provides a lightweight communication protocol between client and server, making it a popular building style for cloud-based APIs.
			The control service API consists of a series of routes, each relevant to a particular parameter or set of parameters.
			The internal state is updated when a client sends a request to the API

			\noindent \\Here is an example of a series of REST requests necessary to create the system state shown in the next section.
			\begin{lstlisting}[language=XML]
// Create an LED state with ID 3
PUT http://localhost:5324/ledstate/3
// Set the color of LED state 3 to red
POST http://localhost:5324/ledstate/3/color/ff0000
// Set the intensity of LED state 3 to 85%
POST http://localhost:5324/ledstate/3/intensity/85
// Set the power of LED state to on
POST http://localhost:5324/ledstate/3/power/on

// Add a new schedule with ID 4
PUT http://localhost:5324/schedule/4/
// LED state 3 will trigger at 8:30am
POST http://localhost:5324/schedule/4/hour/0830/ledstate/3
// LED state 4 will trigger at 2:00pm
POST http://localhost:5324/schedule/4/hour/1600/ledstate/4
// LED state 0 will trigger at 9:00pm
POST http://localhost:5324/schedule/4/hour/2100/ledstate/0

// Add a new zone with ID 3
PUT http://localhost:5324/zone/3/
// Set the schedule used by zone 3 to schedule 4
POST http://localhost:5324/zone/3/schedule/4
// Assign LEDs 1 through 4 to zone 3
POST http://localhost:5324/zone/3/leds/1-4
// Assign LEDs 6 through 8 to zone 3
POST http://localhost:5324/zone/3/leds/6-8
// Assign LED 9 to zone 3
POST http://localhost:5324/zone/3/leds/9

// Get the current color of zone 3
GET http://localhost:5324/zone/3/color/

// Delete zone 3
DELETE http://localhost:5324/zone/3/
\end{lstlisting}

			\subsubsection{Internal State}
			The internal state of the system will be represented by a series of objects with variables and methods.
			A class represents a template that can be instantiated into an in-memory object.
			The system consists of a few core objects and several smaller ones.

			\noindent \\This diagram shows the internal state of the control service:

			\begin{center}
				\begin{figure}[H]
					\includegraphics[width=\linewidth]{systemDiagrams/internalstate.png}
					\caption{The Internal state of the Control Service is the primary data representation, which is translated as necessary to persistent storage and LED control system.}
					\label{fig:internalStateDiagram}
				\end{figure}
			\end{center}

			\subsubsection{Data Parser}
			The data parser serves as a translator between persistent storage and internal state.
			When a change is made to the system, the data parser is triggered to update the changed value in persistent storage.
			The parser will also contain any conversion routines necessary should the data format be changed significantly between iterations.


		\subsection{Data Design}
			\subsubsection{Overview}
			% Probably SQLite, because MySQL is a memory hog
			The persistent data storage will be done with a database.
			The Data Parser in the Control Service will translate the internal state into a series of SQL commands to INSERT, UPDATE, or DELETE from the data tables.
			A database is used because of its ability to update, delete, or read a single piece of information without requiring the entire data structure to be read into memory.
			When changes are made to the way data is structured in the internal state, the database can be restructured and updated with a short SQL script.

			\noindent \\These are the tables that exist within the database:
			\begin{center}
				\begin{figure}[H]
					\includegraphics[width=\linewidth]{systemDiagrams/database.png}
					\caption{The database is a table representation of the Control Service internal state}
					\label{fig:databaseDiagram}
				\end{figure}
			\end{center}

			\subsubsection{Data Description}

			\subsubsection{Zones table}
			\subsubsection{Schedules table}
			\subsubsection{Profiles table}
			\subsubsection{Controllers table}

		\subsection{LED Control System}
			\subsubsection{Overview}
			\subsubsection{Slave Controller Communication}
			\subsubsection{Slave Controller Software}

		\subsection{Stretch goal: Custom Enclosure}
			\subsubsection{Overview}
		\subsection{Stretch goal: External sensors}
			\subsubsection{Overview}

	\section{Human Interface Design}
		\subsection{Overview of User Interface}
		\subsection{Command Line Interface}
			\subsubsection{Interface Overview}
			\subsubsection{Mockup}
		\subsection{Web Interface}
			\subsubsection{Interface Overview}
			\subsubsection{Home Page}
			\subsubsection{Mockup}
			\subsubsection{Zones Page}
			\subsubsection{Mockup}
			%... etc for more pages

	% Scheduling
	\section{Project Timeline}
		\subsection{Iteration 1}
		\subsection{Iteration 2}
		\subsection{Iteration 3}
		\subsection{Iteration 4}
		\subsection{Iteration 5}
		\subsection{Iteration 6}

	%\section{Requirements Matrix} %??? What is this, it was in a template somewhere

	\section{Appendices} % OR glossary??



\end{document}
